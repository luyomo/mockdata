# Download the binary to linux
```
admin@workstation:/tmp/mockdata$ wget https://github.com/luyomo/mockdata/releases/download/v0.0.3/mockoracle-0.0.3.x86_64-linux.tar.gz
admin@workstation:/tmp/mockdata$ tar xvf mockoracle-0.0.3.x86_64-linux.tar.gz
```

# Oracle lib preparation
```
admin@workstation/tmp/mockdata$ wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
admin@workstation/tmp/mockdata$ sudo unzip -d /opt/oracle instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
admin@workstation/tmp/mockdata$ export LD_LIBRARY_PATH=/opt/oracle/instantclient_21_4:$LD_LIBRARY_PATH
```

# Config file preparation
```
admin@workstation:/tmp/mockdata$ more /tmp/mockdata/config.toml
[oracle]
username = "user"
password = "password"
host = "oracle host name"
port = 1521
service-name = "dev"
```

# Data generation from mockoracle
## Single table data generation
```
admin@workstation:/tmp/mockdata$ ./bin/mockoracle --config=/tmp/mockdata/config.toml --tables=admin.table01,admin.table02 --num-of-rows=20
20 rows have been instered into table(admin.table01)
20 rows have been instered into table(admin.table02)
```
## Table data generation with foreign key
Here is the example that the table(table01) depends on table(table02), which depends on table(table03). The data is generated by the sequence as below: table03 -> table02 -> table01. Please find the below example.
```
admin@workstation:/tmp/mockdata$ ./bin/mockoracle --config=/tmp/mockdata/config.toml --tables=admin.table01 --num-of-rows=20
```

# Others
* Tool does not support primary key's uniqueness. The data is generated randomly, if it fails, please re-run it.
* The timestamp is not garanteed. Currently it only supports 23-JAN-23 10:11:23.000000 PM

# TODO
## Check table whether has foreign key
Add reference key into config
  table name |
```
SELECT a.table_name, a.column_name, a.constraint_name, c.owner,
       c.r_owner, c_pk.table_name r_table_name, c_pk.constraint_name r_pk
  FROM all_cons_columns a
  JOIN all_constraints c
    ON a.owner = c.owner
   AND a.constraint_name = c.constraint_name
  JOIN all_constraints c_pk
    ON c.r_owner = c_pk.owner
   AND c.r_constraint_name = c_pk.constraint_name
 WHERE c.constraint_type = 'R'
   AND a.owner = 'ADMIN'
   AND a.table_name = 'ADMIN_USER'
```

## Query to get columns
```
SELECT tbl.OWNER as SCHEMA_NAME, tbl.TABLE_NAME, tbl.COLUMN_NAME,  ref_tbl.REF_QUERY
     , DATA_TYPE, DATA_LENGTH, DATA_PRECISION, DATA_SCALE, NULLABLE, CHARACTER_SET_NAME
     , COLLATION, USER_GENERATED, ref_tbl.REF_QUERY
FROM  DBA_TAB_COLS tbl
LEFT JOIN (
 SELECT c.owner, a.table_name, a.column_name, 
        'SELECT ' || c_cols.column_name || ' FROM ' || c.r_owner || '.' ||  c_pk.table_name as ref_query
   FROM all_cons_columns a
   JOIN all_constraints c
     ON a.owner = c.owner
    AND a.constraint_name = c.constraint_name
   JOIN all_constraints c_pk
     ON c.r_owner = c_pk.owner
    AND c.r_constraint_name = c_pk.constraint_name
   JOIN all_cons_columns c_cols
     ON c_pk.owner = c_cols.owner
    AND c_pk.constraint_name = c_cols.constraint_name
  WHERE c.constraint_type = 'R'
    AND UPPER(a.owner) = UPPER('ADMIN')
    AND UPPER(a.table_name) = UPPER('ADMIN_USER')
  ) ref_tbl
  ON tbl.owner = ref_tbl.owner
 AND tbl.table_name = ref_tbl.table_name
 AND tbl.column_name = ref_tbl.column_name
WHERE UPPER(tbl.owner) = UPPER('ADMIN')
AND UPPER(tbl.TABLE_NAME) = UPPER('ADMIN_USER')
ORDER BY COLUMN_ID



        c.r_owner, c_pk.table_name r_table_name, c_cols.column_name r_column_name, 

 SELECT c.owner, a.table_name, a.column_name, 
        'SELECT ' || c_cols.column_name || ' FROM ' || c.r_owner || '.' ||  c_pk.table_name as ref_query
   FROM all_cons_columns a
   JOIN all_constraints c
     ON a.owner = c.owner
    AND a.constraint_name = c.constraint_name
   JOIN all_constraints c_pk
     ON c.r_owner = c_pk.owner
    AND c.r_constraint_name = c_pk.constraint_name
   JOIN all_cons_columns c_cols
     ON c_pk.owner = c_cols.owner
    AND c_pk.constraint_name = c_cols.constraint_name
  WHERE c.constraint_type = 'R'
    AND a.owner = 'ADMIN'
    AND a.table_name = 'ADMIN_USER'
```
